<template>
  <div>
    <input value="永夜" id="musicName"/>
    <button @click="this.play.bind(this)">播放</button>
    <button @click="this.pause.bind(this)">暂停</button>
    <button @click="this.start.bind(this)">开始</button>
    <button @click="this.stop.bind(this)">停止</button>
    <button @click="this.getMusic.bind(this)">getMusic</button>
    <!-- <audio src="http://localhost:3000/getParticalMusic?name=永夜.mp3"></audio> -->
  </div>
</template>

<script>
  import Grass from '@rustle/grass'
  import Hearken from '../src'
  import ajax from '../test/xhr'

  export default class Root extends Grass.Component {
    constructor () {
      super()
      // testAjax()
      this.Hearken = new Hearken.Media()
      this.stream = new Hearken.Stream('audio/mpeg', true)
      window.h = this.Hearken
      window.s = this.stream
    }

    play () {
      if (this.Hearken) {
        this.Hearken.play()
      }
    }

    pause () {
      if (this.Hearken) {
        this.Hearken.pause()
      }
    }

    start () {
      if (this.Hearken) {
        this.Hearken.start(this.stream)
      }
    }

    stop () {
      if (this.Hearken) {
        this.Hearken.stop()
      }
    }

    getMusic () {
      ajax('http://localhost:3000/getParticalMusic?name=盲点', (err, { response }, fn) => {
        if (err) throw err
        window.aa = response
        this.stream.append(response)
        fn()
      })
      ajax.end = this.stream.end
      this.Hearken.start(this.stream).then(r => console.log(r))
      this.Hearken.on('playError', e => console.log(e))
    }
  }
</script>